{include file="hea"}
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 产品管理 <span class="c-gray en">&gt;</span> 品牌管理 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
<div class="page-container">
    <div class="text-c">
        <form class="Huiform" method="post" action="" target="_self" >
<!--            <input type="text" placeholder="分类名称" value="" id="brand_name" class="input-text" style="width:120px">-->
<!--            <input type="text" placeholder="具体描述" value="" id="brand_description"  class="input-text" style="width:120px">-->
                商品属性：
                <span class="select-box" style="width: 200px;"  >
				<select class="select" size="1" id="cate"  onchange="cate1()">
<!--					<option value="0" selected>请选择商品</option>-->
				</select>
				</span>
                        <input type="text" placeholder="分类名称" value="" id="cate_name" class="input-text" style="width:120px">
            <button type="button" class="btn btn-success" id="add" ><i class="Hui-iconfont">&#xe600;</i> 添加</button>
        </form>
    </div>
    <div class="cl pd-5 bg-1 bk-gray mt-20"> <span class="l">
        <a href="javascript:;" onclick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a>　
        <a class="btn btn-primary radius" id="bute_add"><i class="Hui-iconfont">&#xe600;</i> 添加分类</a>
    </span> <span class="r">共有数据：<strong>54</strong> 条</span> </div>
    <div class="mt-20">
        <input type="" id="__token__" name="__token__" value="{$Request.token}" />
        <table class="table table-border table-bordered table-bg table-sort">
            <thead>
            <tr class="text-c">
                <th width="25"><input type="checkbox" name="" value=""></th>
                <th width="120">ID</th>
                <th width="">属性分类</th>
                <th width="120">操作</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
<!--修改开始-->
<div id="modal-demo" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 900px;height: 1200px">
        <div class="modal-content radius">
            <div class="modal-header">
                <h3 class="modal-title">属性修改</h3>
                <a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
            </div>
            <article class="page-container">
                <form action="" method="post" class="form form-horizontal" id="form-admin-role-add">
                    <div class="row cl">
                        <label class="form-label col-xs-4 col-sm-3"></label>
                        <div class="formControls col-xs-8 col-sm-9">
                            <dl class="permission-list">
                                <dt>
                                    <label>
                                        <input type="checkbox" value="" name="user-Character-0" id="user-Character-0">
                                        <span id="att"></span>管理</label>
                                </dt>
                                <dd>
                                    <dl class="cl permission-list2" id="show">
                                    </dl>　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　
                                    <input class="btn btn-danger radius" type="button" value="删除选中"id="del1">
                                </dd>
                            </dl>
                            <div class="row cl">
                                <label class="form-label col-xs-9 col-sm-2"><span class="c-red">*</span>角色名称：</label>
                                <div class="formControls col-xs-9 col-sm-9" >
                                    <input type="text" class="input-text" value="" placeholder="" id="name" name="roleName"style="width: 400px">
                                    <input class="btn btn-primary radius" type="button" value="添加" id="add1" >

                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </article>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
            </div>
        </div>
    </div>
</div>

<!--修改结束-->
<!--添加属性分类-->
<div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content radius">
            <div class="modal-header">
                <h3 class="modal-title">对话框标题</h3>
                <a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
            </div>
            <article class="page-container">
                <form action="" method="post" class="form form-horizontal" id="form-member-add">
                    <div class="row cl">
                        <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>分类：</label>
                        <div class="formControls col-xs-8 col-sm-9">
                            <input type="text" class="input-text" value="" placeholder="" id="ibute_name" name="username">
                        </div>
                    </div>
                    <div class="row cl">
                        <label class="form-label col-xs-4 col-sm-3">备注：</label>
                        <div class="formControls col-xs-8 col-sm-9">
                            <textarea name="beizhu" cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" onKeyUp="$.Huitextarealength(this,100)"></textarea>
                            <p class="textarea-numberbar"><em class="textarea-length">0</em>/100</p>
                        </div>
                    </div>
                </form>
            </article>


            <div class="modal-footer">
                <button class="btn btn-primary" id="ibtueadd">添加</button>
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
            </div>
        </div>
    </div>
</div>
<span hidden id="ibute_id"></span>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="__ADMAN__/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="__ADMAN__/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="__ADMAN__/static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="__ADMAN__/static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__ADMAN__/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="__ADMAN__/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="__ADMAN__/lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript">
</script>
</body>
</html>
<script>
    ////attr_category 属性分类表开始
    function attr_cateshow(){
        $.ajax({
            url:"{:url('Attribute/attr_cate')}",
            dataType:'json',
            success:function (res) {
                // console.log(res)
                var data=res.data;
                var tr='';
                for (var i=0; i < data.length; i++){
                    tr+="<option value='"+data[i].cate_id+"' >"+data[i].cate_name+"</option>"
                }
                $("#cate").html(tr);
            }
        })
    }
    attr_cateshow()
    //添加
    $("#add").click(function(){
        var cate_name=$('#cate_name').val()
        $.ajax({
            url:"{:url('Attribute/attr_add')}",
            data:{
                cate_name:cate_name,
            },
            type: 'POST',
            dataType:'json',
            success:function (res) {
                if (res.status=='ok') {
                    attr_cateshow()

                    $.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
                } else {
                    $.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
                }
            }
        })
    })

    //主页
    function cate1() {
        var cate_id = $('#cate  option:selected').val();////////////////////////////////////////////////
        if (cate_id==null){
            var cate_id=1;
        }
        $.ajax({
            url:"{:url('Attribute/show')}",
            data:{
                cate_id:cate_id
            },
            type: 'POST',
            dataType:'json',
            success:function (res) {
                // console.log(res)
                var data=res.data;
                var tr='';
                if (res.status=='ok') {
                    for (var i=0; i < data.length; i++){
                        tr+="<tr class='text-c'><td><input type='checkbox' value='' class='cbox'></td>"
                        tr+="<td>"+data[i].ibute_id+" </td>"
                        tr+="<td>"+data[i].ibute_name+"</td>"
                        tr+="<td class='f-14 product-brand-manage'><a  style='text-decoration:none' onClick=detailsshow('"+data[i].ibute_id+"') id='show1' href='javascript:; ' title='编辑'><i  class='Hui-iconfont'>详情&#xe6df;</i></a>"
                        tr+="<a style='text-decoration:none' class='ml-5' onClick=attribute_del('"+data[i].ibute_id+"') href='javascript:;' title='删除'><i class='Hui-iconfont'>&#xe6e2;</i></a></td></tr>"
                    }
                    $(".table tbody").html(tr);
                }
            }
        })
    }
    cate1()
    //属性详情
    function  show1() {
        var ibute_id=$('#ibute_id').html()
        $.ajax({
            url:"{:url('Attribute/detailsshow')}",
            data:{
                ibute_id:ibute_id
            },
            type: 'POST',
            dataType:'json',
            success:function (res) {
                // console.log(res)
                $('#att').html(res.name)
                dl='';
                $.each(res.data,function( key,value){
                    dl=dl+"<label class=''><input id='checkbox' class='cbox' name='message' type='checkbox' value='"+value['id']+"'>"+value['details_name']+"</label>　"
                })
                $('#show').html(dl)
            }
        })
    }
    function detailsshow(ibute_id){
        $('#ibute_id').html(ibute_id)
        $("#modal-demo").modal("show")
        show1()
    }
    //删除属性分类
    $("#del1").click(function(){
        layer.confirm('确认要删除吗？',function(index){
            var result=""
            var count=0
            $('.cbox').each(function () {
                if ($(this).is(':checked')) {
                    result+=$(this).val()+",";
                    count++;
                }
            })
            $.ajax({
                url:"{:url('Attribute/attr_details_del')}",
                data:{
                    id:result
                },
                type: 'POST',
                dataType:'json',
                success:function (res) {
                    // console.log(res)
                    if (res.status=='ok') {
                        show1()
                        layer.msg('已删除!',{icon:1,time:1000});
                    } else {
                        $.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
                    }
                }
            })
        })
    })
    //属性分类添加
    $("#bute_add").click(function() {
        $("#modal").modal("show")
        $("#ibtueadd").click(function() {
        var cate_id = $('#cate  option:selected').val();
        var ibute_name = $('#ibute_name ').val();
        $.ajax({
            url: "{:url('Attribute/attribute_add')}",
            data: {
                cate_id: cate_id,
                ibute_name: ibute_name
            },
            type: 'POST',
            dataType: 'json',
            success: function (res) {
                console.log(res)
                if (res.status=='ok') {
                    cate1()
                    $("#modal").modal("hide")
                    $.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
                } else {
                    $.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
                }
            }
        })
        })
    })

    $("#add1").click(function(){
        var name=$('#name').val()
        var ibute_id=$('#ibute_id').html()
        $.ajax({
            url:"{:url('Attribute/attr_details_add')}",
            data:{
                ibute_id:ibute_id,
                details_name:name
            },
            type: 'POST',
            dataType:'json',
            success:function (res) {
                // console.log(res)
                if (res.status=='ok') {
                    show1()
                    $.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
                } else {
                    $.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
                }
            }
        })
    })
    function attribute_del(ibute_id){
        layer.confirm('确认要删除吗？',function(index){
            $.ajax({
                url:"{:url('Attribute/attribute_del')}",
                data:{
                    ibute_id:ibute_id,
                },
                type: 'POST',
                dataType:'json',
                success:function (res) {
                    // console.log(res)
                    if (res.status=='ok') {
                        layer.msg(res.message,{icon:1,time:1000});
                        cate1()
                    } else {
                        $.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
                    }
                }
            })
        })
    }
</script>

<script type="text/javascript" src="__ADMAN__/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script>
    /*管理员-权限-删除*/
    function active_del(obj,id){
        layer.confirm('确认要删除吗？',function(index){
            $.ajax({
                url: "{:url('Goodsbrand/delAction')}",
                data:{
                    id:id,
                },
                type: 'POST',
                dataType: 'json',
                success: function(res){
                    // console.log(res)
                    if (res.status=='ok') {
                        $(obj).parents("tr").remove();
                        layer.msg('已删除!',{icon:1,time:1000});
                    }else {
                        $.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+data.status,1500)
                    }
                },
            });
        });
    }
</script>