{include file="hea"}
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 产品管理 <span class="c-gray en">&gt;</span> 品牌管理 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
<div class="page-container">
	<div class="text-c">
		<form class="Huiform" method="post" action="" target="_self">
			<input type="text" placeholder="分类名称" value="" id="brand_name" class="input-text" style="width:120px">
			<input type="text" placeholder="具体描述" value="" id="brand_description"  class="input-text" style="width:120px">
			<span class="btn-upload form-group">
			<input class="input-text upload-url" type="text" name="myfile"  id="myfile1"  readonly style="width:200px">
			<a href="javascript:void();" class="btn btn-primary upload-btn"><i class="Hui-iconfont">&#xe642;</i> 上传logo</a>
			<input type="file" id="myfile" multiple name="file-2" class="input-file">
			</span>
			<button type="button" class="btn btn-success" id="add" ><i class="Hui-iconfont">&#xe600;</i> 添加</button>
		</form>
	</div>
	<div class="cl pd-5 bg-1 bk-gray mt-20"> <span class="l"><a href="javascript:;" onclick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a></span> <span class="r">共有数据：<strong>54</strong> 条</span> </div>
	<div class="mt-20">

		<input type="" id="__token__" name="__token__" value="{$Request.token}" />
		<table class="table table-border table-bordered table-bg table-sort">
			<thead>
			<tr class="text-c">
				<th width="25"><input type="checkbox" name="" value=""></th>
				<th width="120">ID</th>
				<th width="300">LOGO</th>
				<th width="150">品牌名称</th>
				<th>具体描述</th>
				<th width="120">操作</th>
			</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
</div>
<!--修改开始-->
<div id="modal-demo" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content radius">
			<div class="modal-header">
				<h3 class="modal-title">品牌修改</h3>
				<a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
			</div>
		<article class="page-container">
			<form class="form form-horizontal" id="form-admin-add">
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>品牌名称：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="text" class="input-text" value="" placeholder="" id="name" name="adminName">
						<input type="hidden" id="bid" value="">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>具体描述：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="text" class="input-text" autocomplete="off" value="" placeholder="对产品的具体描述" id="description" name="password">
					</div>
				</div>
				<div class="row cl">
							<span class="btn-upload form-group">　　　　<span style="color: red;">*</span>更换logo　　　
							<span id="logo"></span> <input type="hidden" id="logo1">
							<a href="javascript:void();" class="btn btn-primary upload-btn"><i class="Hui-iconfont">&#xe642;</i> 上传logo</a>
							<input type="file" id="file" multiple name="file-2" class="input-file">
							</span>
				</div>
			</form>
		</article>
			<div class="modal-footer">
				<button class="btn btn-primary" id="updataaction">确定</button>
				<button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
			</div>
		</div>
	</div>
</div>
<div id="myimg" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content radius" style="width: 300px"  >
			<div class="modal-header">
				<h3 class="modal-title">对话框标题</h3>
				<a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
			</div>
			<div class="modal-body">
				<p>对话框内容…</p>
			</div>
			<div class="modal-footer">
				<button class="btn btn-primary">确定</button>
				<button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
			</div>
		</div>
	</div>
</div>
<!--修改结束-->
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="__ADMAN__/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="__ADMAN__/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="__ADMAN__/static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="__ADMAN__/static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__ADMAN__/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="__ADMAN__/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="__ADMAN__/lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript">
</script>
</body>
</html>
<script>


		$('#add').click(function () {
			var formData = new FormData();
			var __token__=$('#__token__').val()
			var name=$('#brand_name').val()
			var brand_description=$('#brand_description').val()
			formData.append('myfile',$('#myfile')[0].files[0] );
			formData.append('name', name);
			formData.append('brand_description', brand_description);
			formData.append('__token__', __token__);
			$.ajax({
					url:"{:url('Goodsbrand/addAction')}",
					type: 'POST',
					data: formData,
					contentType: false, // 注意这里应设为false
					processData: false,
					cache: false,
				success:function(res){
					token()
					console.log(res)
					if (res.status=='ok') {
						$.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
						show()
					}
					if (res.status=='error') {
						$.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
					}
				}
			})
		});
		function show(){
			$.ajax({
				url:"{:url('Goodsbrand/show')}",
				data:{
					html_type:'json',
				},
				dataType:'json',
				type:'post',
				success:function (res) {
					if (res.status=='error') {
						alert(res.data)
					}else{
						var data=res.data;
						var tr='';
						if (res.status=='ok') {
							for (var i=0; i < data.length; i++){
								tr+="<tr class='text-c'><td><input type='checkbox' value='' class='cbox'></td>"
								tr+="<td>"+data[i].brand_id+"</td>"
								tr+="<td onClick=imga()><img style='width: 200px;height: 40px' src='__TY__/uploads/"+data[i].brand_logo+"'  ></td>"
								tr+="<td>"+data[i].brand_name+"</td>"
								tr+="<td>"+data[i].brand_description+"</td>"
								tr+="<td class='f-14 product-brand-manage'><a style='text-decoration:none' onClick=update('"+data[i].brand_name+"','"+data[i].brand_id+"','"+data[i].brand_logo+"','"+data[i].brand_description+"') href='javascript:;' title='编辑'><i class='Hui-iconfont'>&#xe6df;</i></a>"
								tr+="<a style='text-decoration:none' class='ml-5' onClick=active_del(this,'"+data[i].brand_id+"') href='javascript:;' title='删除'><i class='Hui-iconfont'>&#xe6e2;</i></a></td></tr>"
							}
							$(".table tbody").html(tr);
						}
					}
				}
			})
		}
		show()
		//选择文件时将图片显示出来
		// $('#chooseImage').on('change',function(){
		// 	var filePath = $(this).val(),         //获取到input的value，里面是文件的路径
		// 			fileFormat = filePath.substring(filePath.lastIndexOf(".")).toLowerCase(),
		// 			src = window.URL.createObjectURL(this.files[0]); //转成可以在本地预览的格式
		//
		// 	// 检查是否是图片
		// 	if( !fileFormat.match(/.png|.jpg|.jpeg/) ) {
		// 		error_prompt_alert('上传错误,文件格式必须为：png/jpg/jpeg');
		// 		return;
		// 	}
		// 	$('#newimg').html("<img src='"+src+"'style='height: 150px;width: 200px'>");
		//
		// });
		// //弹出时将id和旧图片显示在弹框内
		// function imga(id,img) {
		// 	$("#myimg").modal("show")
		//
		// 	// $("#oldimg").attr('src',"/uploads/"+img)
		// 	// $("#mid").val(id)
		// }



	function update(name,id,logo,description){
		$("#modal-demo").modal("show")
		$('#name').val(name)
		$('#bid').val(id)
		$('#description').val(description)
		$('#logo').html('<img style="width: 200px;height: 30px" src="__TY__/uploads/'+logo+'">')
		$('#logo1').val(logo)
	}
	$('#updataaction').click(function () {
		var formData = new FormData();
		var __token__=$('#__token__').val()
		var name=$('#name').val()
		var id=$('#bid').val()
		var brand_description=$('#description').val()
		var logo=$('#logo1').val()

		formData.append('file',$('#file')[0].files[0] );
		formData.append('name', name);
		formData.append('brand_description', brand_description);
		formData.append('__token__', __token__);
		formData.append('logo', logo);
		formData.append('id', id);
		$.ajax({
			url:"{:url('Goodsbrand/updateaction')}",
			type: 'POST',
			data: formData,
			contentType: false, // 注意这里应设为false
			processData: false,
			cache: false,
			success:function (res) {
				token()
				console.log(res)
				if (res.status=='ok') {
					$.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
					$("#modal-demo").modal("hide")
					show()
				}
				if (res.status=='error') {
					$.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+res.message,1500)
				}
			}
		})
	})



</script>

<script type="text/javascript" src="__ADMAN__/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script>
	/*管理员-权限-删除*/
	function active_del(obj,id){
		layer.confirm('确认要删除吗？',function(index){
			$.ajax({
				url: "{:url('Goodsbrand/delAction')}",
				data:{
					id:id,
				},
				type: 'POST',
				dataType: 'json',
				success: function(res){
					console.log(res)
					if (res.status=='ok') {
						$(obj).parents("tr").remove();
						layer.msg('已删除!',{icon:1,time:1000});
					}else {
						$.Huimodalalert('<i class="Hui-iconfont">&#xe691;</i>  '+data.status,1500)
					}
				},
			});
		});
	}



</script>
